#!/bin/bash

if id postgres >/dev/null ; then
  echo '<<<postgres_sessions>>>'
  echo "select current_query = '<IDLE>', count(*) from pg_stat_activity group by (current_query = '<IDLE>');" | su - postgres -c "psql -A -t -F' '"
  echo '<<<postgres_stat_database>>>'
  # The following statement might change in future for better cross-version
  # compatibility.
  echo 'select *, pg_database_size(datname) as "datsize" from pg_stat_database;' \
     | su - postgres -c "psql -A -F' '" | sed '$d'
fi
