#!/usr/bin/python


# This check verifies a given NFS export is registered with mountd.
# Optionally we can add tracking of allowed clients and filesystem ID.

# Agent info
# [['/mirrored/data/recording', '172.0.0.0/255.0.0.0']]




def inventory_nfsexports(checkname, info):
    # reminder to self: inventorize the exported fs, and maybe even the fs id.
    # but do not inventorize the allowed clients unless i'm really sure that 
    # it's not bugged for "features" like multiple different option exports of 
    # same FS. 
    inventory = []
    for line in info:
        # will not inventorize unless there is SOME export at inventory time.
        if line[0].startswith("/"):
            inventory.append((line[0], None))

    return inventory


def check_nfsexports(item, _no_params, info):
    # if the agent returned an empty list then it found entries in /etc/exports
    # but apparently no daemons were running.
    if len(info) == 0:
        return (2, "CRITICAL - exports defined but no exports found in export list. Daemons might not be working")

    # otherwise lets see if our export exists.
    for line in info:
        exported_path = line[0]
        if exported_path == item:
            return (0, "OK - export is active")
    return (2, "CRITICAL - export not found in export list")
        
#    return (3, "UNKNOWN - invalid data returned from Agent")




check_info['nfsexports'] = (check_nfsexports, "NFS export %s", 0, inventory_nfsexports)
