#!/usr/bin/python

aironet_default_error_levels = ( 1.0, 10.0 ) # per second

def inventory_aironet_errors(checkname, info):
    return [ (int(line[0]), "", 'aironet_default_error_levels') for line in info ]

def check_aironet_errors(item, params, info):
    for line in info:
	if int(line[0]) == item:
	    value = int(line[1])
            this_time = time.time()
	    timedif, persec = get_counter("aironet_errors.%s" % item, this_time, value)
	    warn, crit = params
	    perfdata = [("errors","%dc" % value, None, None, warn, crit)]
	    infotxt = " - %.2f errors/s in last %d secs" % (persec, int(timedif))
	    if persec >= crit:
		return (2, "CRIT" + infotxt, perfdata)
	    elif persec >= warn:
		return (1, "WARN" + infotxt, perfdata)
            else:
		return (0, "OK" + infotxt, perfdata)


    return (3, "UNKNOW - No radio %s available" % item)
	 

check_info['aironet_errors'] = ( check_aironet_errors, "MAC CRC errors radio %s", 1, inventory_aironet_errors )
snmp_info['aironet_errors'] = ( "1.3.6.1.4.1.9.9.272.1.2.1.1.1", [0, 2] )
# CISCO-DOT11-IF-MIB::cd11IfRecFrameMacCrcErrors

snmp_scan_functions['aironet_errors'] \
	= lambda oid: oid(".1.3.6.1.2.1.1.2.0") == ".1.3.6.1.4.1.9.1.685"
