def inventory_mounts(checktype, info):
    inventory = []
    for dev, mp, fstype, options, dump, fsck in info:
	if fstype not in [ 'tmpfs' ]:
	    opts = options.split(",")
	    opts.sort()
	    inventory.append( (mp, opts) )
    return inventory

def check_mounts(item, targetopts, info):
    for dev, mp, fstype, options, dump, fsck in info:
	if item == mp:
            targetopts.sort()
	    opts = options.split(",")
	    opts.sort()
	    if opts != targetopts:
		return (2, "CRIT - mount options are %s, expected are %s" % (",".join(opts), ",".join(targetopts)))
	    else:
		return (0, "OK - mount options are %s" % (",".join(opts)))
    return (3, "UNKNOWN - filesystem not mounted")
	    

check_info['mounts'] = ( check_mounts, "Mount options of %s", 0, inventory_mounts)
