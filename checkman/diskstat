title: Disk throughput
agents: linux, freebsd
catalog: os/storage
license: GPL
distribution: check_mk
description:

 This check measures the throughput of block devices (disks) on Linux
 hosts. You can either have a single check for every single disk
 or a summary check (which is the default) summing up the throughput
 of all disks.

 For legacy reasons it is also possible (but not advisable) to have all disks
 summarized but with a separate check for read and write (this is how this
 check worked up to version 1.1.10).

 The check also gives info on the IO latency and IOPS (unmerged) aquired
 from the kernels information in /proc.

 You can apply separate warning and critical levels for the read
 and write throughput. Optionally you can have the check compute
 average values on a configurable time period and have the levels
 applied on the average instead of the current values. This makes
 it possible to ignore short "peaks" and only trigger and longer
 phases of high disk activity.

 Averaging is not applied to IO latency calculations.

 The check has to provide many ways of configuration for legacy reasons.
 We strongly recommend you switch to the rule-based configuration, which
 handles anything you want it to.

 In single disk mode the check now also supports being used in a Check_MK
 cluster environment. In this case it goes to CRIT if it finds more than
 one disk item in the cluster. If it finds only one disk item, it also prints
 the node name the disk was found on.

 SUMMARY and legacy read/write modes are not supported in a cluster
 configuration.  The check goes to UNKNOWN and prints an appropriate message
 if configured like that.

item:
 Either {"SUMMARY"} for a summarized check of all disks or the name of the
 disk device, e.g. {"sda"}. Additionally also one service per logical volume
 defined in Linux LVM and Veritas VxVM on Linux.

 In order to support configurations
 up to version 1.1.10 also the items {"read"} and {"write"} are supported.


examples:
 # switch inventory behaviour to 1.1.10 mode
 diskstat_inventory_mode = "legacy"

 # alternative: create one check for all disks
 diskstat_inventory_mode = "summary"

 # Set default levels for diskstat
 diskstat_default_levels = {
   "read" :    (10, 20),   # level for read MB/sec
   "write" :   (20, 40),   # level for write MB/sec
   "average" : 15,         # averaging in minutes
 }

 # Alternative: just enable averaging over 10 minutes,
 # do not apply levels:
 diskstat_default_levels = {
     "average" : 15
 }

 # Settings for certain hosts:
 check_parameters += [
   ( {"write" : (20, 50), "average" : 10 }, [ "oracle" ], ALL_HOSTS, [ "Disk IO" ])
 ]

 # New way:

 # Enable and configure the inventory behaviour based with rule-based settings
 diskstat_inventory_mode = "rule"
 diskstat_inventory += [
  ( ['summary', 'lvm', 'vxvm'], [], ALL_HOSTS ),
 ]

 # Then configure levels for 50/90MB/s read IO over 10 Minutes and a bit less for
 # writes. Next put levels on IO latency exceeding 80ms / 160ms.
 checkgroup_parameters.setdefault('disk_io', [])
 checkgroup_parameters['disk_io'] += [
   ( {'read': (50.0, 90.0), 'write': (40.0, 60.0), 'average': 10, 'latency_perfdata': True, 'latency': (80.0, 160.0)}, [], ALL_HOSTS, ALL_SERVICES ),
 ]




inventory:
  The inventory is configured via {diskstat_inventory_mode}. If this is set
  to {"single"} (the default), then one check will be created for each
  disk. If it is set to {"summary"} then only one service per host will be
  created that has at least one hard disk. If set to {"legacy"} then a
  separate check for read and write will be created (deprecated).

